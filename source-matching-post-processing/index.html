
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="IBM watsonx Code Assistant for Red Hat Ansible Lightspeed - Generative AI Training">
      
      
        <meta name="author" content="Christopher Bienko (cdbienko@us.ibm.com)">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.1">
    
    
      
        <title>Content Source Matching and Post-Processing - IBM watsonx Code Assistant for Red Hat Ansible Lightspeed - Generative AI Training</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#content-source-matching-and-attribution" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="IBM watsonx Code Assistant for Red Hat Ansible Lightspeed - Generative AI Training" class="md-header__button md-logo" aria-label="IBM watsonx Code Assistant for Red Hat Ansible Lightspeed - Generative AI Training" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IBM watsonx Code Assistant for Red Hat Ansible Lightspeed - Generative AI Training
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Content Source Matching and Post-Processing
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IBM watsonx Code Assistant for Red Hat Ansible Lightspeed - Generative AI Training" class="md-nav__button md-logo" aria-label="IBM watsonx Code Assistant for Red Hat Ansible Lightspeed - Generative AI Training" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    IBM watsonx Code Assistant for Red Hat Ansible Lightspeed - Generative AI Training
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Setup and Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../generating/" class="md-nav__link">
        Generating Code
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Content Source Matching and Post-Processing
      </a>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../customizing/" class="md-nav__link">
        Task Description Tuning and Model Customization
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<p><div class="video-container"><video style="position: relative; width: 100%; height: 22.172vw" controls  ><source src="../_videos/source-matching-post-processing.mp4" type="video/mp4" /></video></div></p>
<div class="admonition quote">
<p><strong>Christopher Bienko</strong> (<em>IBM, Learning Content Development</em>) demonstrates key elements of the <code>Content Source Matching and Post-Processing</code> module [10 min].</p>
</div>
<p><br/></p>
<h1 id="content-source-matching-and-attribution">Content source matching and attribution</h1>
<h1 id="_1"></h1>
<p>At this point, you should now be well acquainted with <em>Ansible Tasks</em> and <em>Playbooks</em>. Ansible Playbooks are comprised of multiple Tasks — which you have been using <em>IBM watsonx Code Assistant's</em> (<strong>WCA</strong>) generative AI capabilities to define and expand upon.</p>
<p>If a Playbook contains multiple "tasks" that together achieve some singular goal or purpose, you might want to group these tasks into a single reusable unit. For example, a string of "tasks" might provision infrastructure for separate development, test, and production clusters from a major cloud vendor. Patterns for automating endpoints from these vendors can be codified into <strong>Ansible Modules</strong>, which are supported by Red Hat and the Ansible community writ large.</p>
<p>And finally, collections of Playbooks and Modules can be organized into "blueprints" for automation tasks that are frequently used together to achieve some goal; a goal which you might want to make repeatable or shareable with other teams within your business. These blueprints are referred to as <strong>Ansible Roles</strong>. They provide a structured way to organize tasks, templates, files, and variables, and are available to drop directly into Ansible Playbooks. Roles make it possible to easily manage and set up complex automation tasks, essentially providing a rubric to streamline automation projects.</p>
<h1 id="_2"></h1>
<h1 id="collectively-these-playbooks-modules-and-roles-form-a-comprehensive-ecosystem-of-business-and-community-driven-support-for-patterning-automation-to-work-with-the-broadest-range-of-vendors-technologies-and-clouds">Collectively, these Playbooks, Modules, and Roles form a <strong>comprehensive ecosystem of business and community-driven support</strong> for patterning automation to work with the broadest range of vendors, technologies, and clouds.</h1>
<h1 id="_3"></h1>
<p><strong><a href="https://galaxy.ansible.com" target="_blank">Ansible Galaxy</a></strong> is a Red Hat-curated, community-driven repository for <em>Ansible Roles</em>. Via communities such as Galaxy, thousands of Roles are available for Ansible users to leverage within their own Playbooks. Ansible Galaxy is also key to how generative AI code recommendations from WCA are attributed back to original content sources and authors.</p>
<hr />
<p><a class="glightbox" href="../_attachments/figure38.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../_attachments/figure38.png" /></a></p>
<hr />
<p>A powerful capability within WCA is <strong>Content Source Matching</strong> (often referred to as "code explainability"), which attempts to match AI-generated code suggestions to the training data and sources that were utilized in generating the suggested Task code.</p>
<p>These code attribution suggestions are created using a <strong>k-NN</strong> (<a href="https://www.ibm.com/topics/knn#:~:text=Next%20steps-,K%2DNearest%20Neighbors%20Algorithm,of%20an%20individual%20data%20point." target="_blank">K-Nearest Neighbors</a>) algorithm that examines <strong>Ansible Galaxy</strong> and training data repositories in search of the nearest related content to the AI-generated code suggestions.</p>
<hr />
<ol>
<li>
<p>To enable <strong>Content Source Matching</strong> capabilities within WCA, navigate to the main menu bar for VS Code and drill down into <strong>View</strong> &gt; <strong>Open View...</strong><sup>[A]</sup></p>
<p><br/>
<a class="glightbox" href="../_attachments/contentmatching1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/contentmatching1.png" width="600" /></a></p>
</li>
</ol>
<hr />
<ol start="2">
<li>
<p>The console<sup>[A]</sup> along the top of the VS Code interface is now activated and awaiting a prompt. Type <code>Lightspeed Training Matches</code> and hit <span class="keys"><kbd class="key-enter">Enter</kbd></span> to confirm the selection.</p>
<ul>
<li>
<p>After making this configuration change to VS Code, all requests for WCA to generate code recommendations will now open a panel at the bottom of the VS Code interface</p>
</li>
<li>
<p>It is under the <code>Ansible</code> tab that <strong>content source matching</strong> results will be displayed</p>
</li>
<li>
<p>Other tabs will also displayed for variety of options: <code>Problems</code>, <code>Output</code>, <code>Debug Console</code>, <code>Terminal</code>, and <code>Ports</code></p>
</li>
</ul>
<p><br/>
<a class="glightbox" href="../_attachments/contentmatching2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/contentmatching2.png" width="600" /></a></p>
</li>
</ol>
<hr />
<ol start="3">
<li>Open the <code>install_pgsql-single-task.yml</code> Ansible Playbook, which is included within the <code>ansible-wca-demo-kit</code> directory. The full location of the Playbook, as well as the contents, are available in the code block below.</li>
</ol>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">~/Documents/ansible-wca-demo-kit/install and configure PostgreSQL and PGAdmin container/install_pgsql-single-task.yml</label></div>
<div class="tabbed-content">
<div class="tabbed-block"></div>
</div>
</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure Database servers</span><span class="w"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">databases</span><span class="w"></span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="c1"># TASK 1</span><span class="w"></span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="c1"># - name: Install postgresql-server</span><span class="w"></span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="c1"># TASK 2</span><span class="w"></span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="c1"># Ansible Lightspeed used an easy-to-understand natural language prompt and suggested the correct, more complex PostgreSQL CLI command to initiate the database.</span><span class="w"></span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="c1"># Ansible Lightspeed used best practices and kept the task idempotent by including creates: /var/lib/pgsql/data/postgresql.conf in the suggestion.</span><span class="w"></span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="c1"># - name: Run postgresql setup command</span><span class="w"></span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="c1"># TASK 3</span><span class="w"></span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="c1"># Ansible Lightspeed used natural language prompt and added state: started and enabled: true module arguments based on Start and enable... in the Ansible task description.</span><span class="w"></span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="c1"># - name: Start and enable postgresql service</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<hr />
<ol start="4">
<li>
<p>Generate a code recommendation for the task on <strong>Line 8</strong> by placing your cursor at the end of the line and hitting <span class="keys"><kbd class="key-enter">Enter</kbd></span>.</p>
<ul>
<li>
<p>Pay attention to the code attribution details associated with this recommendation, which will be appearing under the <code>Ansible</code> tab at the bottom of the VS Code interface once the code recommendation is finalized.</p>
</li>
<li>
<p>You will need to <strong>accept</strong> the AI-generated code suggestions (using the <span class="keys"><kbd class="key-tab">Tab</kbd></span> key) <em>before</em> the <code>Ansible</code> content source matching tab will provide details about the code's origins.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install postgresql-server</span><span class="w"></span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nt">ansible.builtin.package</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql-server</span><span class="w"></span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class="w"></span>
</code></pre></div>
</li>
</ol>
<hr />
<ol start="5">
<li>
<p>The three most likely content sources used in training the WCA model— which produced the AI-generated code recommendations —are listed within the <code>Ansible</code> <strong>tab</strong><sup>[A]</sup>. Recall from earlier that these code attribution suggestions are created using a <strong>k-NN</strong>  algorithm that searches <strong>Ansible Galaxy</strong> repositories for the nearest related content to the AI-generated code suggestions.</p>
<p>Clicking the arrow icon to the left of each <strong>attribution</strong><sup>[B]</sup> will expand further details about the source. Information about the <code>URL</code>, <code>Path</code>, <code>Data Source</code>, <code>License</code>, <code>Ansible Type</code>, and <code>Score</code> are displayed (where available) under each listing. Red Hat-certified and maintained collections, as well as contributors to open source projects on Ansible Galaxy, are the primary sources for Ansible Lightspeed model training and are the content sources you are most likely to see matched to AI-generated code recommendations.</p>
<p><br/>
<a class="glightbox" href="../_attachments/contentmatching5.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/contentmatching5.png" width="600" /></a></p>
</li>
</ol>
<hr />
<ol start="6">
<li>
<p>Drilling down into the <code>URL</code> field will redirect your web browser back to the precise collections and sources on <strong>Ansible Galaxy</strong> from which the code recommendations were derived. Here you can learn much richer details about the status of the project, any associated open source repositories involved (such as GitHub), contributions and activities ongoing with the code base, the author(s) involved, and many more intricacies.</p>
<p><br/>
<a class="glightbox" href="../_attachments/contentmatching6.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/contentmatching6.png" width="600" /></a></p>
</li>
</ol>
<hr />
<h1 id="_4"></h1>
<h1 id="post-processing-of-task-descriptions-and-yaml-file-contents-helps-generate-contextually-aware-accurate-ansible-content-suggestions"><strong>Post-processing</strong> of Task descriptions and YAML file contents helps generate contextually aware, accurate Ansible content suggestions.</h1>
<h1 id="_5"></h1>
<hr />
<p><a class="glightbox" href="../_attachments/figure39.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../_attachments/figure39.png" /></a></p>
<p>Another element of code generation that WCA excels at is understanding <strong>context</strong> within the Playbook it is executing against. If a variable or attribute is defined earlier within that Playbook, it will be recalled and referenced— where it makes sense to do so —in the generation of subsequent lines of code. You may have already noticed these <strong>post-processing capabilities</strong> in your experimentations with WCA-generated code suggestions.</p>
<p>However, one way to make this feature quite obvious is to take a previously-generated block of Ansible Task code, update the value assigned to a named variable <em>earlier</em> in the Playbook, and then regenerate the Task code block. In theory, the newly-generated Task block will use the updated variable name (and differ from how the code block was originally generated).</p>
<hr />
<ol start="7">
<li>
<p>Create a <strong>New File...</strong> YAML Playbook named <code>demo_provision_ec2_instance.yml</code> anywhere within the <code>/ansible-wca-demo-kit/</code> directory.</p>
<ul>
<li>
<p>You may save the Playbook in the root of the folder or any of the subdirectories</p>
</li>
<li>
<p>Be sure to reference the expandable tooltips below for instructions on how to perform these operations and how to configure the Playbook language for use with WCA</p>
</li>
<li>
<p><strong>Copy and paste</strong> the following code block into the <code>demo_provision_ec2_instance.yml</code> Playbook and then save the file</p>
</li>
</ul>
<details class="quote">
<summary>HOW TO CREATE NEW <code>YAML</code> PLAYBOOKS</summary>
<p><strong>Note:</strong> You need to copy and paste the contents of the Playbook into a <strong>New File...</strong> within the <em>same</em> Lightspeed project directory that was used for the previous lab modules in order for the VS Code extension to engage.</p>
<p>To create a new YAML Playbook within a VS Code environment:</p>
<p><strong>a.</strong> Copy the contents of the Playbook to clipboard using the button in the top-right corner of the lab guide code block.</p>
<p><a class="glightbox" href="../_attachments/figure18.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/figure18.png" width="400" /></a></p>
<p><strong>b.</strong> Return to your VS Code environment. In the top-left corner of the interface, with your Ansible Lightspeed folder selected, click the <strong>New File...</strong> button.</p>
<p><a class="glightbox" href="../_attachments/figure19.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/figure19.png" width="400" /></a></p>
<p><strong>c.</strong> Name the file to a description of your choosing, ending with <code>.yml</code> as the filetype. Set it to <code>CustomPlaybook.yml</code>, for example. Save it to one of the directories in the <code>ansible-wca-demo-kit</code> folder.</p>
<p><strong>d.</strong> Paste the clipboard contents into the YAML file and follow along with the suggestions below.</p>
</details>
<details class="quote">
<summary>COPY AND PASTE CODE WITHIN THE VM</summary>
<p>Information "copied" to your local machine's clipboard cannot be "pasted" directly into the virtual machine (VM) environment or VS Code. If you wish to copy and paste instructions directly from the lab documentation, it is recommended that you open the GitHub instructions <strong>inside</strong> the VM's web browser (Firefox). This will allow you to copy instructions to the VM's clipboard and paste instructions inside the VS Code editor.</p>
</details>
<details class="quote">
<summary>ANSIBLE LIGHTSPEED IS MISSING OR CODE RECOMMENDATIONS ARE NOT GENERATING</summary>
<p>Ansible Lightspeed and WCA will only generate code recommendations for <em>Ansible Playbooks</em> and <em>YAML</em> files. VS Code will typically auto-detect the programming language of the document you're working with, but on occassion you may need to manually specify the language. Even if working with a YAML file, you'll still need to specify the language mode as <code>Ansible</code> for the Lightspeed plugin to engage.</p>
<p>To set the language mode correctly:</p>
<ul>
<li>
<p>In the bottom-right corner of the VS Code interface, hover over the <strong>Select Language Mode</strong> toggle<sup>[A]</sup></p>
</li>
<li>
<p>A console will appear at the top of VS Code with a drop-down list of options<sup>[B]</sup></p>
</li>
<li>
<p>Click <code>Ansible</code> from the suggested languages, or enter the text yourself and hit <span class="keys"><kbd class="key-enter">Enter</kbd></span></p>
</li>
<li>
<p>Confirm that the Select Language Mode toggle in the bottom-right corner displays <code>Ansible</code></p>
</li>
</ul>
<p><br/>
<a class="glightbox" href="../_attachments/troubleshooting-2.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/troubleshooting-2.png" width="600" /></a></p>
<p><a class="glightbox" href="../_attachments/troubleshooting-3.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/troubleshooting-3.png" width="600" /></a></p>
</details>
</li>
</ol>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">demo_provision_ec2_instance.yml</label></div>
<div class="tabbed-content">
<div class="tabbed-block"></div>
</div>
</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span>
<span class="normal"><a href="#__codelineno-2-32">32</a></span>
<span class="normal"><a href="#__codelineno-2-33">33</a></span>
<span class="normal"><a href="#__codelineno-2-34">34</a></span>
<span class="normal"><a href="#__codelineno-2-35">35</a></span>
<span class="normal"><a href="#__codelineno-2-36">36</a></span>
<span class="normal"><a href="#__codelineno-2-37">37</a></span>
<span class="normal"><a href="#__codelineno-2-38">38</a></span>
<span class="normal"><a href="#__codelineno-2-39">39</a></span>
<span class="normal"><a href="#__codelineno-2-40">40</a></span>
<span class="normal"><a href="#__codelineno-2-41">41</a></span>
<span class="normal"><a href="#__codelineno-2-42">42</a></span>
<span class="normal"><a href="#__codelineno-2-43">43</a></span>
<span class="normal"><a href="#__codelineno-2-44">44</a></span>
<span class="normal"><a href="#__codelineno-2-45">45</a></span>
<span class="normal"><a href="#__codelineno-2-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nn">---</span><span class="w"></span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EC2 Cloud Operations</span><span class="w"></span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span><span class="w"></span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span><span class="w"></span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">  </span><span class="nt">module_defaults</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="nt">group/aws</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">      </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span><span class="w"></span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">  </span><span class="c1"># vars:</span><span class="w"></span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">  </span><span class="c1">#   ec2_instance:</span><span class="w"></span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">  </span><span class="c1">#     name: lightspeed-instance-01</span><span class="w"></span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">  </span><span class="c1">#     key_name: lightspeed-keypair</span><span class="w"></span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">  </span><span class="c1">#     image_id: ami-016eb5d644c333ccb # RHEL 9 us-east-1</span><span class="w"></span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">  </span><span class="c1">#     tags:</span><span class="w"></span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">  </span><span class="c1">#       function: lightspeed-demo</span><span class="w"></span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">  </span><span class="c1">#     security_group: secgroup-lightspeed</span><span class="w"></span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">  </span><span class="nt">tasks</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">        </span><span class="c1"># TASK 1</span><span class="w"></span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">        </span><span class="c1"># # 1a. Uncomment task description below and generate a task suggestion.</span><span class="w"></span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">        </span><span class="c1"># #     Note - Best practices: The suggestion used the Fully Qualified Collection name.</span><span class="w"></span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">        </span><span class="c1"># #     Note - Context: Ansible Lightspeed used the Playbook name &quot;EC2 Cloud Operations&quot; to use the correct &quot;amazon.aws.ec2_vpc_subnet_info&quot; module.</span><span class="w"></span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gather subnet info tag:Name subnet-lightspeed</span><span class="w"></span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># TASK 2</span><span class="w"></span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">#</span><span class="w"> </span><span class="c1"># 2a. Uncomment task description below and generate a task suggestion.</span><span class="w"></span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="w">        </span><span class="c1"># #     Note - Context: The suggestion included the previous task&#39;s registered variable in the suggestion.</span><span class="w"></span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="w">        </span><span class="c1"># #     Note - Accuracy: The suggestion provides the correct key value from the previously task&#39;s registered variable.</span><span class="w"></span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create vpc_subnet_id var</span><span class="w"></span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain"># TASK 3</span><span class="w"></span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">#</span><span class="w"> </span><span class="c1"># 3a. Uncomment task description &quot;Provision t3.micro instance&quot; below and generate a task suggestion.</span><span class="w"></span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="w">        </span><span class="c1"># #     Note - Efficiency: The suggestion provides practical variable examples to improve efficiency.</span><span class="w"></span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Provision t3.micro instance</span><span class="w"></span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">#</span><span class="w"> </span><span class="c1"># 3b. Remove the above task and suggestion.</span><span class="w"></span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="w">        </span><span class="c1"># #     Uncomment 2nd task description &quot;Provision t3.micro instance using ec2_instance var&quot;.</span><span class="w"></span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="w">        </span><span class="c1"># #     Generate an updated suggestion.</span><span class="w"></span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="w">        </span><span class="c1"># #     Note - Context: The updated suggestion includes the &quot;ec2_instance variable fields in the suggestion&quot;</span><span class="w"></span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Provision t3.micro instance using ec2_instance var</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<hr />
<ol start="8">
<li><code>TASK 1</code> (<strong>Line 26</strong>) and <code>TASK 2</code> (<strong>Line 33</strong>) are responsible for gathering information about a network subnet that is to be provisioned and then creating a virtual private cloud (VPC) definition based on those details.</li>
</ol>
<hr />
<ol start="9">
<li>
<p>Generate suggested code for <code>TASK 1</code> (<strong>Line 26</strong>) by placing the cursor at the end of the line, hitting <span class="keys"><kbd class="key-enter">Enter</kbd></span>, and then confirming with <span class="keys"><kbd class="key-tab">Tab</kbd></span>. Afterwards, perform the same steps to generate code for <code>TASK 2</code> as well.</p>
<ul>
<li>
<p>The first round of WCA-generated code produces a code block<sup>[A]</sup> with a <code>register: subnet_info</code> (<strong>Line 30</strong>), the result of which is to assign this VPC definition to a variable <code>subnet_info</code>. Nothing terribly complicated or surprising about that.</p>
</li>
<li>
<p>The WCA-generated code that follows for the task on <strong>Line 38</strong> (previously <em>Line 33</em> in the raw template) recommends a code block<sup>[B]</sup> with <code>vpc_subnet_id: "{ { subnet_info.subnets[0].subnet_id } }"</code> as the value associated with the VPC's subnet ID. Critically, the variable <code>subnet_info</code> that was generated in the previous Task<sup>[A]</sup> is also referenced in the second Task. This demonstrates the contextual awareness of WCA in action.</p>
</li>
</ul>
<p><br/>
<a class="glightbox" href="../_attachments/contentmatching7.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/contentmatching7.png" width="600" /></a></p>
<p><a class="glightbox" href="../_attachments/contentmatching8.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/contentmatching8.png" width="600" /></a></p>
</li>
</ol>
<hr />
<ol start="10">
<li>
<p>Change the name of variable <code>subnet_info</code> to <code>subnet_name</code> on <strong>Line 30</strong>. Then delete the code block recommendations under <strong>Line 38</strong> and regenerate the task.</p>
<ul>
<li>
<p>Notice that the new block<sup>[A]</sup> of <code>TASK 2</code> now references the variable <code>subnet_name</code> that was modified just a moment ago in <code>TASK 1</code></p>
</li>
<li>
<p>WCA has generated code for <code>TASK 2</code> that takes into account the <strong>modified context and variables</strong> from <code>TASK 1</code> of the Playbook</p>
</li>
</ul>
<p><br/>
<a class="glightbox" href="../_attachments/contentmatching9.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" loading="lazy" src="../_attachments/contentmatching9.png" width="600" /></a></p>
<p><br/></p>
<p>Continue experimenting with WCA's contextual awareness and post-processing capabilities. Try adjusting other variables within the Playbook and study how these modifications impact the generation of later blocks of Task code within the Playbook. </p>
</li>
</ol>
<hr />
<h1 id="_6"></h1>
<h1 id="next-steps">Next steps</h1>
<p>In the next section, you will begin experimenting with customized Ansible Playbooks and testing how changes to Ansible Task natural language descriptions impacts the recommended code produced by WCA.</p>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../generating/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Generating Code" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Generating Code
            </div>
          </div>
        </a>
      
      
        
        <a href="../customizing/" class="md-footer__link md-footer__link--next" aria-label="Next: Task Description Tuning and Model Customization" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Task Description Tuning and Model Customization
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 IBM
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "content.code.annotate"], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>